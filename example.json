{
  "variables": {
    "home":    "{{env `HOME`}}",
    "out_dir": "output-box",
    "name":    "base-host",
    "box":     "archlinux",
    "repo":    "archlinux",
    "version": "2018.01.07"
  },
  "builders": [{
    "type": "virtualbox-ovf",
    "source_path": "{{user `home`}}/.vagrant.d/boxes/{{user `repo`}}-VAGRANTSLASH-{{user `box`}}/{{user `version`}}/virtualbox/box.ovf",
    "ssh_username": "vagrant",
    "ssh_password": "vagrant",
    "ssh_wait_timeout": "90s",
    "shutdown_command": "echo 'packer' | sudo -S shutdown -P now"
  }],
  "provisioners": [{
    "type": "shell",
    "execute_command": "sh '{{ .Path }}'",
    "inline": [
      "sudo pacman -Syu --noconfirm",
      "sudo pacman -S --noconfirm base-devel libxslt git python imagemagick ghostscript pdf2svg texlive-core texlive-pictures texlive-latexextra texlive-fontsextra texlive-science texlive-games asymptote sagemath",
      "git clone https://github.com/rbeezer/mathbook.git && chown vagrant:vagrant mathbook",
      "sudo dd if=/dev/zero of=/EMPTY bs=1M",
      "sudo rm -f /EMPTY"
    ]
  }],
  "post-processors": [{
    "type": "vagrant",
    "keep_input_artifact": true,
    "output": "{{user `out_dir`}}/{{user `name`}}-{{user `repo`}}-{{user `box`}}-{{user `version`}}.box"
  }]
}
